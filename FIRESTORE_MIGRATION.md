# –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –≤ Firebase Firestore

## üìã –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ–Ω–æ—Å–∞ –±–∞–∑—ã –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ JSON-—Ñ–∞–π–ª–æ–≤ –≤ Firebase Firestore –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ firebase-admin

```bash
cd /Users/osmaav/Downloads/el-bez/app
npm install firebase-admin
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç Firebase

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/)
2. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ–µ–∫—Ç `el-bez-before-1000v`
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Project Settings** (‚öôÔ∏è) ‚Üí **Service Accounts**
4. –ù–∞–∂–º–∏—Ç–µ **Generate New Private Key**
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ JSON-—Ñ–∞–π–ª —Å –∫–ª—é—á–æ–º

### 3. –†–∞–∑–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –∫–ª—é—á–∞

–ü–æ–º–µ—Å—Ç–∏—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª `serviceAccountKey.json` –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞:

```
el-bez/
‚îú‚îÄ‚îÄ app/
‚îú‚îÄ‚îÄ serviceAccountKey.json  ‚Üê –°—é–¥–∞
‚îî‚îÄ‚îÄ scripts/
```

–ò–ª–∏ —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export FIREBASE_SERVICE_ACCOUNT_KEY=/path/to/your/key.json
```

### 4. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ Firestore

–í Firebase Console –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Firestore Database** ‚Üí **Rules** –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ:

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // –í–æ–ø—Ä–æ—Å—ã - —á—Ç–µ–Ω–∏–µ –¥–ª—è –≤—Å–µ—Ö, –∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
    match /questions/{questionId} {
      allow read: if true;
      allow write: if request.auth != null && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
    
    // –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π - —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
    match /user_states/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
    
    // –ü—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && request.auth.uid == userId;
    }
  }
}
```

## üöÄ –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

```bash
cd /Users/osmaav/Downloads/el-bez/app
node scripts/migrate-questions-to-firestore.js
```

### –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥

```
üöÄ –ù–∞—á–∞–ª–æ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ Firestore...

üìÇ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞: /path/to/questions-1256-19.json
üìã –†–∞–∑–¥–µ–ª: 1256-19

üìä –ù–∞–π–¥–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: 250
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 250 –≤–æ–ø—Ä–æ—Å–æ–≤
‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è 1256-19

üìÇ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–∞: /path/to/questions-1258-20.json
üìã –†–∞–∑–¥–µ–ª: 1258-20

üìä –ù–∞–π–¥–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: 304
‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ 554 –≤–æ–ø—Ä–æ—Å–æ–≤
‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è 1258-20

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
üéâ –ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!
üìä –í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: 554
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Firestore

### –ö–æ–ª–ª–µ–∫—Ü–∏—è `questions`

–ö–∞–∂–¥—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –≤–æ–ø—Ä–æ—Å–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:

```javascript
{
  id: number,           // ID –≤–æ–ø—Ä–æ—Å–∞ (1, 2, 3...)
  ticket: number,       // –ù–æ–º–µ—Ä –±–∏–ª–µ—Ç–∞ (1-25 –∏–ª–∏ 1-31)
  section: string,      // '1256-19' –∏–ª–∏ '1258-20'
  question: string,     // –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞
  answers: string[],    // –ú–∞—Å—Å–∏–≤ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
  correct: number,      // –ò–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ (0-3)
  link: string,         // –°—Å—ã–ª–∫–∞ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫ (–ü–£–≠, –ü—Ä–∏–∫–∞–∑ –∏ —Ç.–¥.)
  createdAt: Timestamp, // –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è
  updatedAt: Timestamp  // –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

### –ò–Ω–¥–µ–∫—Å—ã

–°–æ–∑–¥–∞–π—Ç–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:

1. **–ü–æ —Ä–∞–∑–¥–µ–ª—É –∏ ID:**
   - `section` (ascending)
   - `id` (ascending)

2. **–ü–æ —Ä–∞–∑–¥–µ–ª—É –∏ –±–∏–ª–µ—Ç—É:**
   - `section` (ascending)
   - `ticket` (ascending)
   - `id` (ascending)

### –ö–æ–ª–ª–µ–∫—Ü–∏—è `user_states`

–î–æ–∫—É–º–µ–Ω—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```javascript
{
  currentSection: string,    // –¢–µ–∫—É—â–∏–π —Ä–∞–∑–¥–µ–ª ('1256-19' –∏–ª–∏ '1258-20')
  currentPage: string,       // –¢–µ–∫—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ('theory', 'learning', etc.)
  progress: {                // –ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±—É—á–µ–Ω–∏—è
    [ticketId: number]: {
      completed: boolean,
      score: number,
      lastAttempt: Timestamp
    }
  },
  settings: {                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    darkMode: boolean,
    notifications: boolean
  },
  updatedAt: Timestamp       // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
}
```

## üîÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞

### 1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```typescript
// AppContext.tsx
useEffect(() => {
  const loadQuestions = async () => {
    // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ Firestore (–∏–ª–∏ JSON –≤ mock-—Ä–µ–∂–∏–º–µ)
    const loadedQuestions = await loadQuestionsForSection(currentSection);
    setQuestions(loadedQuestions);
  };
  loadQuestions();
}, [currentSection]);
```

### 2. –ü—Ä–∏ —Å–º–µ–Ω–µ —Ä–∞–∑–¥–µ–ª–∞

```typescript
// –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–µ–Ω—è–µ—Ç —Ä–∞–∑–¥–µ–ª –≤ Navigation
setCurrentSection('1256-19');

// AppContext –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
// Firestore –∑–∞–ø—Ä–æ—Å: questions.where('section', '==', '1256-19')
```

### 3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```typescript
// –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã/—Ä–∞–∑–¥–µ–ª–∞
await saveUserState(userId, {
  currentSection: '1256-19',
  currentPage: 'theory'
});
```

## üìà –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

| –î–æ | –ü–æ—Å–ª–µ |
|----|-------|
| JSON —Ñ–∞–π–ª—ã ~960 KB | –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ |
| –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã —Å—Ä–∞–∑—É | –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Ä–∞–∑–¥–µ–ª–∞–º |
| –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ |
| –ù–µ—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ | Firestore Analytics |
| –†—É—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ | –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Firestore Console |

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ Firestore Console

–û—Ç–∫—Ä–æ–π—Ç–µ [Firebase Console](https://console.firebase.google.com/) ‚Üí **Firestore Database**

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤–∏–¥–Ω—ã:
- –ö–æ–ª–ª–µ–∫—Ü–∏—è `questions` (554 –¥–æ–∫—É–º–µ–Ω—Ç–∞)
- –ö–æ–ª–ª–µ–∫—Ü–∏—è `user_states` (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```
üîµ [AppContext] –ó–∞–≥—Ä—É–∑–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ä–∞–∑–¥–µ–ª–∞: 1258-20
üîç [QuestionService] –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ Firestore...
‚úÖ [QuestionService] –ó–∞–≥—Ä—É–∂–µ–Ω–æ 304 –≤–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ Firestore
üîµ [AppContext] –ó–∞–≥—Ä—É–∂–µ–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤: 304
```

## üõ† –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ —á–µ—Ä–µ–∑ Firestore Console

1. –û—Ç–∫—Ä–æ–π—Ç–µ **Firestore Database** ‚Üí –∫–æ–ª–ª–µ–∫—Ü–∏—è `questions`
2. –ù–∞–∂–º–∏—Ç–µ **Add Document**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è:
   - `id`: —Å–ª–µ–¥—É—é—â–∏–π –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä
   - `ticket`: –Ω–æ–º–µ—Ä –±–∏–ª–µ—Ç–∞
   - `section`: "1256-19" –∏–ª–∏ "1258-20"
   - `question`: —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞
   - `answers`: –º–∞—Å—Å–∏–≤ ["–û—Ç–≤–µ—Ç 1", "–û—Ç–≤–µ—Ç 2", "–û—Ç–≤–µ—Ç 3", "–û—Ç–≤–µ—Ç 4"]
   - `correct`: –∏–Ω–¥–µ–∫—Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ (0-3)
   - `link`: –∏—Å—Ç–æ—á–Ω–∏–∫

### –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

–î–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ - –æ–Ω –¥–æ–±–∞–≤–∏—Ç –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è.

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Mock-—Ä–µ–∂–∏–º**: –ï—Å–ª–∏ Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∏–∑ JSON-—Ñ–∞–π–ª–æ–≤
2. **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í–æ–ø—Ä–æ—Å—ã –∫–µ—à–∏—Ä—É—é—Ç—Å—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
3. **–ò–Ω–¥–µ–∫—Å—ã**: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ Firestore Console

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Firebase Firestore Documentation](https://firebase.google.com/docs/firestore)
- [Firebase Admin SDK](https://firebase.google.com/docs/admin/setup)
- [Firestore Data Modeling](https://firebase.google.com/docs/firestore/manage-data/structure-data)
